---
import { getCollection, render } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";

const changelog = (await getCollection("changelog"))
  .filter((entry) => entry.data.lang === "ja")
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const entries = await Promise.all(
  changelog.map(async (entry) => {
    const { Content } = await render(entry);
    const date = new Intl.DateTimeFormat("ja-JP", {
      year: "numeric",
      month: "long",
      day: "numeric"
    }).format(entry.data.date);
    return { entry, Content, date };
  })
);
---

<BaseLayout
  locale="ja"
  title="LogMaru | 更新履歴"
  description="LogMaru のリリース情報、機能追加、修正内容をバージョンごとに確認できます。"
>
  <h1 class="page-title changelog-title">更新履歴</h1>
  <section class="changelog-list" aria-label="更新履歴">
    {entries.map(({ entry, Content, date }) => (
      <article class="changelog-entry card">
        <h2 class="changelog-version">{entry.data.version}</h2>
        <p class="changelog-date muted">{date}</p>
        <div class="changelog-content">
          <Content />
        </div>
      </article>
    ))}
  </section>
</BaseLayout>
