---
import { getCollection, render } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

const changelog = (await getCollection("changelog"))
  .filter((entry) => entry.data.lang === "en")
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

const entries = await Promise.all(
  changelog.map(async (entry) => {
    const { Content } = await render(entry);
    const date = new Intl.DateTimeFormat("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric"
    }).format(entry.data.date);
    return { entry, Content, date };
  })
);
---

<BaseLayout locale="en" title="LogMaru | Changelog">
  <h1 class="page-title changelog-title">Changelog</h1>
  <section class="changelog-list" aria-label="Release history">
    {entries.map(({ entry, Content, date }) => (
      <article class="changelog-entry card">
        <h2 class="changelog-version">{entry.data.version}</h2>
        <p class="changelog-date muted">{date}</p>
        <div class="changelog-content">
          <Content />
        </div>
      </article>
    ))}
  </section>
</BaseLayout>
